---
/**
 * ServiceCard Component
 * Card for service offerings with icon and description
 *
 * From Figma node 555-4074:
 * - Service Box: 384x384px square with centered icon
 * - Noise overlay at 30% opacity
 * - Dot grid overlay at 20% opacity
 * - Text content below the box
 */

import NoiseOverlay from '../base/NoiseOverlay.astro';
import GridOverlay from '../base/GridOverlay.astro';
import ArrowLink from './ArrowLink.astro';

interface Props {
  /**
   * Service title
   */
  title: string;

  /**
   * Service description
   */
  description: string;

  /**
   * Icon URL (SVG from /icons/abstract/)
   */
  icon?: string;

  /**
   * Image URL for the card (optional, replaces icon box)
   */
  image?: string;

  /**
   * Image alt text
   */
  imageAlt?: string;

  /**
   * Link URL
   */
  href?: string;

  /**
   * Background color variant for icon box
   * @default 'dark'
   */
  background?: 'dark' | 'accent';

  /**
   * Additional CSS class
   */
  class?: string;
}

const {
  title,
  description,
  icon,
  image,
  imageAlt = '',
  href = '#',
  background = 'dark',
  class: className
} = Astro.props;
---

<article class:list={['service-card', className]}>
  <!-- Icon Box (square) -->
  <div class:list={['service-box', `service-box--${background}`]}>
    <!-- Color blobs (visible on hover) -->
    <div class="service-box-blobs" aria-hidden="true">
      <div class="blob blob--orange"></div>
      <div class="blob blob--green"></div>
    </div>

    {image ? (
      <img src={image} alt={imageAlt} class="service-box-image" loading="lazy" />
    ) : icon ? (
      <img src={icon} alt="" class="service-box-icon" aria-hidden="true" />
    ) : (
      <slot name="icon" />
    )}
    <NoiseOverlay opacity={0.7} />
    <GridOverlay opacity={0.5} />
  </div>

  <!-- Text Content -->
  <div class="service-card-content">
    <h3 class="service-card-title">{title}</h3>
    <p class="service-card-description">{description}</p>
    <div class="service-card-link">
      <ArrowLink text="Learn more" href={href} />
    </div>
  </div>
</article>

<style>
  .service-card {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
    width: 384px;
    flex-shrink: 0;
    transition: transform 0.15s ease;
    -webkit-tap-highlight-color: transparent;
  }

  /* Square icon box - matches Figma 384x384 */
  .service-box {
    position: relative;
    aspect-ratio: 1 / 1;
    width: 100%;
    border-radius: var(--radius-md);
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.4s ease;
  }

  .service-box--dark {
    background-color: var(--bg-dark);
  }

  .service-box--accent {
    background-color: var(--bg-accent);
  }

  /* Hover: transition to accent background */
  .service-card:hover .service-box--dark {
    background-color: var(--bg-accent);
  }

  /* Touch/click feedback for mobile */
  .service-card:active {
    transform: scale(0.98);
  }

  .service-card:active .service-box {
    opacity: 0.9;
  }

  /* Color blobs container */
  .service-box-blobs {
    position: absolute;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
    z-index: 0;
  }

  /* Individual blobs - hidden by default, visible on hover */
  .blob {
    position: absolute;
    border-radius: 50%;
    filter: blur(96px);
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  .blob--orange {
    width: 367px;
    height: 329px;
    background: var(--accent-orange);
    top: 97px;
    left: -144px;
  }

  .blob--green {
    width: 510px;
    height: 459px;
    background: var(--accent-green);
    top: -312px;
    right: -31px;
  }

  /* Show blobs on hover */
  .service-card:hover .blob {
    opacity: 1;
  }

  .service-box-icon {
    position: relative;
    z-index: 5;
    width: 96px;
    height: 96px;
    object-fit: contain;
  }

  .service-box-image {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 1;
    transition: transform var(--transition-medium);
  }

  .service-card:hover .service-box-image {
    transform: scale(1.05);
  }

  /* Text content below box */
  .service-card-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  .service-card-title {
    font-size: var(--text-h4);
    line-height: 1.25;
    margin: 0;
  }

  .service-card-description {
    font-size: var(--text-body);
    color: var(--text-muted);
    line-height: 1.4;
    margin: 0;
  }

  .service-card-link {
    margin-top: auto;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .service-box,
    .blob,
    .service-box-icon,
    .service-box-image {
      transition: none;
    }
  }

  @media (max-width: 991px) {
    .service-card {
      width: 320px;
    }

    .blob--orange {
      width: 250px;
      height: 220px;
    }

    .blob--green {
      width: 340px;
      height: 300px;
    }
  }

  /* Tablet/Mobile - full width cards in grid */
  @media (max-width: 767px) {
    .service-card {
      width: 100%;
    }

    .service-card-title {
      font-size: var(--text-h5);
    }

    .service-box-icon {
      width: 72px;
      height: 72px;
    }

    .blob--orange {
      width: 200px;
      height: 180px;
    }

    .blob--green {
      width: 280px;
      height: 240px;
    }
  }

  /* Small mobile - single column */
  @media (max-width: 479px) {
    .service-card {
      width: 100%;
      gap: var(--space-md);
    }

    .service-box-icon {
      width: 64px;
      height: 64px;
    }

    .service-card-title {
      font-size: var(--text-h5);
    }

    .service-card-description {
      font-size: var(--text-small);
    }

    .blob--orange {
      width: 180px;
      height: 160px;
    }

    .blob--green {
      width: 220px;
      height: 200px;
    }
  }
</style>
